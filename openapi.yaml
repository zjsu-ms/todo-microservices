openapi: 3.0.3
info:
  title: Todo RESTful API
  description: |
    一个简洁的Spring Boot项目，用于演示RESTful API的设计和实现。

    本API实现了用户(User)和待办事项(Todo)的完整CRUD操作，展示了：
    - RESTful API设计原则
    - 统一的响应格式
    - 正确使用HTTP状态码
    - 资源嵌套关系
    - 全局异常处理
  version: 1.0.0
  contact:
    name: API Support
    email: support@example.com

servers:
  - url: http://localhost:8080
    description: 本地开发服务器

tags:
  - name: User
    description: 用户管理接口
  - name: Todo
    description: Todo管理接口
  - name: User-Todo
    description: 用户Todo嵌套资源接口

paths:
  /api/users:
    get:
      tags:
        - User
      summary: 获取所有用户
      description: 返回系统中所有用户的列表
      operationId: getAllUsers
      responses:
        '200':
          description: 成功返回用户列表
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserListResponse'
              example:
                code: 200
                message: "Success"
                data:
                  - id: 1
                    username: "张三"
                    email: "zhangsan@example.com"
                    createdAt: "2025-10-12T10:00:00"
                  - id: 2
                    username: "李四"
                    email: "lisi@example.com"
                    createdAt: "2025-10-12T10:05:00"
                timestamp: "2025-10-12T10:30:00"

    post:
      tags:
        - User
      summary: 创建新用户
      description: 创建一个新的用户
      operationId: createUser
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserInput'
            example:
              username: "王五"
              email: "wangwu@example.com"
      responses:
        '201':
          description: 用户创建成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserResponse'
              example:
                code: 201
                message: "Created"
                data:
                  id: 3
                  username: "王五"
                  email: "wangwu@example.com"
                  createdAt: "2025-10-12T10:30:00"
                timestamp: "2025-10-12T10:30:00"
        '400':
          description: 请求参数错误
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/users/{id}:
    get:
      tags:
        - User
      summary: 根据ID获取用户
      description: 通过用户ID获取用户详细信息
      operationId: getUserById
      parameters:
        - name: id
          in: path
          description: 用户ID
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: 成功返回用户信息
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserResponse'
        '404':
          description: 用户不存在
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                code: 404
                message: "User not found with id: 999"
                data: null
                timestamp: "2025-10-12T10:30:00"

    put:
      tags:
        - User
      summary: 更新用户
      description: 更新指定ID的用户信息
      operationId: updateUser
      parameters:
        - name: id
          in: path
          description: 用户ID
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserInput'
            example:
              username: "张三(已更新)"
              email: "zhangsan.new@example.com"
      responses:
        '200':
          description: 更新成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserResponse'
        '404':
          description: 用户不存在
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    delete:
      tags:
        - User
      summary: 删除用户
      description: 删除指定ID的用户
      operationId: deleteUser
      parameters:
        - name: id
          in: path
          description: 用户ID
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: 删除成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
              example:
                code: 200
                message: "User deleted successfully"
                data: null
                timestamp: "2025-10-12T10:30:00"
        '404':
          description: 用户不存在
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/todos:
    get:
      tags:
        - Todo
      summary: 获取所有Todo
      description: 返回所有Todo列表，可通过userId参数筛选
      operationId: getAllTodos
      parameters:
        - name: userId
          in: query
          description: 按用户ID筛选Todo
          required: false
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: 成功返回Todo列表
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TodoListResponse'
              example:
                code: 200
                message: "Success"
                data:
                  - id: 1
                    title: "学习Spring Boot"
                    description: "完成Spring Boot基础教程"
                    completed: false
                    userId: 1
                    createdAt: "2025-10-12T10:00:00"
                    updatedAt: "2025-10-12T10:00:00"
                  - id: 2
                    title: "实现RESTful API"
                    description: "创建用户和Todo的CRUD接口"
                    completed: false
                    userId: 1
                    createdAt: "2025-10-12T10:05:00"
                    updatedAt: "2025-10-12T10:05:00"
                timestamp: "2025-10-12T10:30:00"

    post:
      tags:
        - Todo
      summary: 创建新Todo
      description: 创建一个新的Todo项
      operationId: createTodo
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TodoInput'
            example:
              title: "新任务"
              description: "任务描述"
              userId: 1
      responses:
        '201':
          description: Todo创建成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TodoResponse'
              example:
                code: 201
                message: "Created"
                data:
                  id: 4
                  title: "新任务"
                  description: "任务描述"
                  completed: false
                  userId: 1
                  createdAt: "2025-10-12T10:30:00"
                  updatedAt: "2025-10-12T10:30:00"
                timestamp: "2025-10-12T10:30:00"
        '404':
          description: 关联的用户不存在
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/todos/{id}:
    get:
      tags:
        - Todo
      summary: 根据ID获取Todo
      description: 通过Todo ID获取Todo详细信息
      operationId: getTodoById
      parameters:
        - name: id
          in: path
          description: Todo ID
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: 成功返回Todo信息
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TodoResponse'
        '404':
          description: Todo不存在
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    put:
      tags:
        - Todo
      summary: 更新Todo
      description: 更新指定ID的Todo信息
      operationId: updateTodo
      parameters:
        - name: id
          in: path
          description: Todo ID
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TodoInput'
            example:
              title: "更新的任务"
              description: "更新的描述"
              completed: true
              userId: 1
      responses:
        '200':
          description: 更新成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TodoResponse'
        '404':
          description: Todo不存在
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    delete:
      tags:
        - Todo
      summary: 删除Todo
      description: 删除指定ID的Todo
      operationId: deleteTodo
      parameters:
        - name: id
          in: path
          description: Todo ID
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: 删除成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '404':
          description: Todo不存在
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/todos/{id}/toggle:
    patch:
      tags:
        - Todo
      summary: 切换Todo完成状态
      description: 切换指定Todo的完成状态（completed字段）
      operationId: toggleTodoComplete
      parameters:
        - name: id
          in: path
          description: Todo ID
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: 状态切换成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TodoResponse'
        '404':
          description: Todo不存在
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/users/{userId}/todos:
    get:
      tags:
        - User-Todo
      summary: 获取指定用户的所有Todo
      description: 通过用户ID获取该用户的所有Todo（资源嵌套示例）
      operationId: getUserTodos
      parameters:
        - name: userId
          in: path
          description: 用户ID
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: 成功返回用户的Todo列表
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TodoListResponse'
        '404':
          description: 用户不存在
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    post:
      tags:
        - User-Todo
      summary: 为指定用户创建Todo
      description: 为指定用户创建新的Todo（资源嵌套示例）
      operationId: createUserTodo
      parameters:
        - name: userId
          in: path
          description: 用户ID
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TodoInputWithoutUserId'
            example:
              title: "新任务"
              description: "为用户创建的任务"
      responses:
        '201':
          description: Todo创建成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TodoResponse'
        '404':
          description: 用户不存在
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:
  schemas:
    User:
      type: object
      properties:
        id:
          type: integer
          format: int64
          description: 用户ID
          example: 1
        username:
          type: string
          description: 用户名
          example: "张三"
        email:
          type: string
          format: email
          description: 邮箱地址
          example: "zhangsan@example.com"
        createdAt:
          type: string
          format: date-time
          description: 创建时间
          example: "2025-10-12T10:00:00"
      required:
        - id
        - username
        - email
        - createdAt

    UserInput:
      type: object
      properties:
        username:
          type: string
          description: 用户名
          example: "张三"
        email:
          type: string
          format: email
          description: 邮箱地址
          example: "zhangsan@example.com"
      required:
        - username
        - email

    Todo:
      type: object
      properties:
        id:
          type: integer
          format: int64
          description: Todo ID
          example: 1
        title:
          type: string
          description: Todo标题
          example: "学习Spring Boot"
        description:
          type: string
          description: Todo描述
          example: "完成Spring Boot基础教程"
        completed:
          type: boolean
          description: 是否完成
          example: false
        userId:
          type: integer
          format: int64
          description: 关联的用户ID
          example: 1
        createdAt:
          type: string
          format: date-time
          description: 创建时间
          example: "2025-10-12T10:00:00"
        updatedAt:
          type: string
          format: date-time
          description: 更新时间
          example: "2025-10-12T10:00:00"
      required:
        - id
        - title
        - completed
        - userId
        - createdAt
        - updatedAt

    TodoInput:
      type: object
      properties:
        title:
          type: string
          description: Todo标题
          example: "学习Spring Boot"
        description:
          type: string
          description: Todo描述
          example: "完成Spring Boot基础教程"
        userId:
          type: integer
          format: int64
          description: 关联的用户ID
          example: 1
      required:
        - title
        - userId

    TodoInputWithoutUserId:
      type: object
      properties:
        title:
          type: string
          description: Todo标题
          example: "学习Spring Boot"
        description:
          type: string
          description: Todo描述
          example: "完成Spring Boot基础教程"
      required:
        - title

    ApiResponse:
      type: object
      properties:
        code:
          type: integer
          description: 状态码
          example: 200
        message:
          type: string
          description: 响应消息
          example: "Success"
        data:
          description: 响应数据
        timestamp:
          type: string
          format: date-time
          description: 响应时间戳
          example: "2025-10-12T10:00:00"
      required:
        - code
        - message
        - timestamp

    UserResponse:
      allOf:
        - $ref: '#/components/schemas/ApiResponse'
        - type: object
          properties:
            data:
              $ref: '#/components/schemas/User'

    UserListResponse:
      allOf:
        - $ref: '#/components/schemas/ApiResponse'
        - type: object
          properties:
            data:
              type: array
              items:
                $ref: '#/components/schemas/User'

    TodoResponse:
      allOf:
        - $ref: '#/components/schemas/ApiResponse'
        - type: object
          properties:
            data:
              $ref: '#/components/schemas/Todo'

    TodoListResponse:
      allOf:
        - $ref: '#/components/schemas/ApiResponse'
        - type: object
          properties:
            data:
              type: array
              items:
                $ref: '#/components/schemas/Todo'

    SuccessResponse:
      allOf:
        - $ref: '#/components/schemas/ApiResponse'
        - type: object
          properties:
            data:
              type: object
              nullable: true

    ErrorResponse:
      allOf:
        - $ref: '#/components/schemas/ApiResponse'
        - type: object
          properties:
            data:
              type: object
              nullable: true
